# 环境贴图
**一、CUBEMAP原理：**

用三维向量ReflectDir去与立方体做相交检测。

1.	首先去判断，这个向量落在了立方体的哪个面，通过判断这个向量的xyz的绝对值哪个是最大的，就落在哪个面。
2.	去计算相交的点。比如落在了X轴，就让x分量变成1，其他yz值乘相同的比例。取YZ坐标作为 uv值。

**局限性：** 只根据方向来采样Cubemap会造成采样点错误，这也是为什么cubemap技术不适用于平面模型反射的原因。

**二、IBL**

基于图像的照明：使用UNITY中convolution type里有一项Specular，这一步unity直接帮我们计算了IBL的一个过程。用了专门的模糊来做各项复杂的光照计算。

**三、球谐光照**

SH球谐光照：优化的IBL技术，从一幅图像里提取出漫反射系信息，计算过程是复杂的计算公式，通过一些复杂的函数把漫反射信息还原出来。他与IBL的区别在于它输出的结果不是以图像来储存，而是以参数的形式来储存，通过参数来还原，比采样图像容易，但是缺点在于，他只能模拟低频的信息。**总的来说，球谐可以模拟低频的漫反射。**

- 反射探针使用到的是环境贴图（cubemap）和IBL来实现。
- 光照探针使用的是球谐函数，通过参数就能很快达到效果。
